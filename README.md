# Delivery Service
![Tests](https://github.com/DeneesK/delivery_service/actions/workflows/test.yml/badge.svg)

Сервис для управления посылками с расчетом стоимости доставки и привязкой к транспортным компаниям

---

## Описание

Проект реализован на FastAPI с использованием Pydantic для валидации данных, MySQL для хранения основной информации, Redis для кеширования и MongoDB для хранения логов расчетов стоимости доставки. Alembic для миграций в DB


Swagger документация доступна после запуска проекта по адресу:  
**OpenAPI:** [http://localhost:8000/api/openapi#/](http://127.0.0.1:8000/api/openapi#/)

### Основные возможности

- Приложение НЕ содержит авторизации, все через сессии
- Централизованный отлов ошибок через exception handlers
- Регистрация посылки с валидацией входных данных  
- Получение списка типов посылок из отдельной таблицы  
- Получение списка посылок пользователя с фильтрацией и пагинацией  
- Получение информации о конкретной посылке по ID  
- Регистрация посылок через брокер сообщений Celery + RabbitMQ с гарантией асинхронности (Периодическая задача расчета стоимость доставки больше не нужна)
- Подсчет суммы стоимостей доставок всех посылок по типам за день(через эндпоинт)
- Привязка посылок к транспортным компаниям с атомарной операцией закрепления 
- Логирование и обработка ошибок  
- Полная докеризация проекта, всех зависимостей и тестов

# delivery_app
управление и создание посылок с расчетом стоимости доставки и привязкой к транспортным компаниям

# register_app
микросервис для созланения посылок в бд и расчета стоимости отправки, а так же отправляет логи расчета стоимости в MongoDB

---

## Технологический стек

- Python 3.12  
- FastAPI  
- Pydantic  
- SQLAlchemy[Async]
- MySQL  
- Redis  
- MongoDB  
- Celery + RabbitMQ  
- Alembic (миграции)
- Punq для DI 
- Docker, Docker Compose  
- Pytest для тестирования
- Poetry  

---

## Предварительные шаги

- Установите `make` (если ещё не установлен)  
- Создайте файл окружения на основе примера:  
```bash
# ./env.example, delivery_app/env.example, register_app/env.example
cp ./env.example ./.env
cp ./delivery_app/env.example delivery_app/.env
cp ./register_app/env.example register_app/.env
```

## Запуск

```bash
make start_app
```

## Запуск тестов
1. <b><i>Запускаются автоматически через GitHub Actions при push
2. Запуск локально:</b></i>
```bash
make start_tests
```

## Результаты нагрузочного теста

![Bombardier Load Test](https://res.cloudinary.com/dipq7i17e/image/upload/v1751852757/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0_2025-07-07_%D0%B2_11.41.08_fabggn.png)
